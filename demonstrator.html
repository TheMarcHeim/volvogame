<html>
<head>
<script src="https://cdn.jsdelivr.net/npm/graphhopper-js-api-client/dist/graphhopper-client.js"></script>
<script type="text/javascript">
function onload(){
     setup();
     passengerList = getPassengers();
     drawPassengers(passengerList);
     drawRoute();
	testrouting();
}

function setup()
{
    map = document.getElementById("map");
    canvas = document.getElementById("canvas");
    canvas.width = document.body.clientWidth;
    canvas.height = document.body.clientHeight; 


    var ctx = canvas.getContext("2d");
    ctx.moveTo(0,0);
    ctx.lineTo(200,100);
    ctx.stroke();
}

function testrouting(){
	var points = [[8.34234,48.23424],
		[8.34423,48.26424]];

	getRouteData(points)
}

function getRouteData(pointlist){
  	var ghRouting = new GraphHopper.Routing({
      key: "792f5935-6974-4c19-9ada-2742bbcdc54f",
      vehicle: "car",
      elevation: false
    });
	alert(pointlist[0]);
	var arrayLength = pointlist.length;
	for (var i = 0; i < arrayLength; i++) {
		ghRouting.addPoint(new GHInput(pointlist[i][0], pointlist[i][1]));
	}


    ghRouting.doRequest()
      .then(function(json) {
 	alert(json);
        console.log(json);
      })
      .catch(function(err) {
        console.error(err.message);
      });

}

function drawRoute(pointlist) {
    pointlist = [[0,0], [20,20], [30, 10]];// For testing purpouses

    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    ctx.moveTo(pointlist[0][0], pointlist[0][1]);

    pointlist.forEach(point => {
        ctx.lineTo(point[0], point[1]);
        ctx.stroke();
        ctx.moveTo(point[0], point[1]);
    });
}

/// Manage Passengers

class Passenger {
    constructor(location, incentive) {
        this.location = location;
        this.incentive = incentive;
    }
}

function getPassengers() {
    passengerList = [new Passenger([550,50], 4), 
                     new Passenger([660,170], 3),
                     new Passenger([1000,400], 0)];
    return passengerList;
}

function drawPassengers(passengerList) {
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    var radius = 5;

    ctx.lineWidth = 1;
    passengerList.forEach(passenger => {
        ctx.beginPath();
        var [x, y] = passenger.location;
        ctx.arc(x, y, radius, 0, 2*Math.PI);
        ctx.fillStyle = '#00E000';
        ctx.fill();
        ctx.strokeStyle = '#000000';
        ctx.stroke();
    });
}

/// Manage UI

function mouseHandler() {
    
}

</script>



<style>
  body {
      background-color: ivory;
  }

  .coveredImage {
      width:100%;
      height:100%;
      position:absolute;
      top:0px;
      left:0px;
  }
  .coveringCanvas {
      width:100%;
      height:100%;
      position:absolute;
      top:0px;
      left:0px;
      background-color: rgba(255, 0, 0, .1);
  }
</style>
</head>
<body onload="onload()">
    <img id="map" src="http://staticmap.openstreetmap.de/staticmap.php?center=40.714728,-73.998672&zoom=14&size=1920x700&maptype=mapnik" class="coveredImage">
    <canvas id="canvas" class="coveringCanvas" onclick="mouseHandler()"></canvas>
</body>
</html>
