<html>
<head>
<meta charset="utf-8"/>
<script src="https://cdn.jsdelivr.net/npm/graphhopper-js-api-client/dist/graphhopper-client.js"></script>
<script type="text/javascript">
function onload(){
     setup();
     passengerList = getPassengers();
     drawPassengers(passengerList);
     drawRoute();
	testrouting();
}

function setup()
{
    map = document.getElementById("map");
    canvas = document.getElementById("canvas");
    canvas.width = document.body.clientWidth;
    canvas.height = document.body.clientHeight; 


    var ctx = canvas.getContext("2d");
    ctx.moveTo(0,0);
    ctx.lineTo(200,100);
    ctx.stroke();
}

function testrouting(){
	var points = [[49.932707,11.588051],
		[50.3404,11.64705]];

	getRouteData(points)
}

function getRouteData(pointlist){
  	var ghRouting = new GraphHopper.Routing({
      key: "792f5935-6974-4c19-9ada-2742bbcdc54f",
      vehicle: "car",
      elevation: false
    });
	var arrayLength = pointlist.length;
	for (var i = 0; i < arrayLength; i++) {
		ghRouting.addPoint(new GHInput(pointlist[i][0], pointlist[i][1]));
	}


    ghRouting.doRequest()
      .then(function(json) {
        console.log(json);
	oldArr = json.paths[0].points.coordinates;
	var res = [];
	delta = 10;
	for (i = 0; i < oldArr.length; i=i+delta) {
	  res.push(oldArr[i]);
	}
	console.log(res);
      })
      .catch(function(err) {
        console.error(err.message);
      });

}

function drawRoute(pointlist) {
    pointlist = [[0,0], [20,20], [30, 10]];// For testing purpouses

    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    ctx.moveTo(pointlist[0][0], pointlist[0][1]);

    pointlist.forEach(point => {
        ctx.lineTo(point[0], point[1]);
        ctx.stroke();
        ctx.moveTo(point[0], point[1]);
    });
}

/// Manage Passengers

class Passenger {
    constructor(location, incentive) {
        this.location = location;
        this.incentive = incentive;
    }
}

function getPassengers() {
    passengerList = [new Passenger([550,50], 4), 
                     new Passenger([660,170], 3),
                     new Passenger([1000,400], 0)];
    return passengerList;
}

function drawPassengers(passengerList) {
    var body = document.getElementById("body");
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    var radius = 5;

    ctx.lineWidth = 1;
    passengerList.forEach(passenger => {
        var [x, y] = passenger.location;
        passengerHTML = `<div class="passenger" style="top: ` + y + `px; left: ` + x + `px;">
                         </div>`;
        body.innerHTML += passengerHTML;
    });
}

/// Manage UI

function mouseHandler() {
    
}

</script>



<style>
  body {
      background-color: ivory;
  }

  .coveredImage {
      width:100%;
      height:100%;
      position:absolute;
      top:0px;
      left:0px;
      z-index: -1;
  }
  .coveringCanvas {
      width:100%;
      height:100%;
      position:absolute;
      top:0px;
      left:0px;
      background-color: rgba(255, 0, 0, .1);
  }
  .passenger {
      position: absolute;
      width: 20px;
      height: 20px;
      background-image: url('passengerGreen.png');
      background-size: cover;
      z-index: 1;
  }
</style>
</head>
<body id="body" onload="onload()">
    <img id="map" src="http://staticmap.openstreetmap.de/staticmap.php?center=40.714728,-73.998672&zoom=14&size=1920x700&maptype=mapnik" class="coveredImage">
    <canvas id="canvas" class="coveringCanvas" onclick="mouseHandler()">
    </canvas>
</body>
</html>
